<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Yocto Project 개발하기(3) - 개발 시 로컬 패키지 관리하기 - All about IoT</title><meta name=Description content><meta property="og:title" content="Yocto Project 개발하기(3) - 개발 시 로컬 패키지 관리하기"><meta property="og:description" content="Yocto Project 개발 절차는 기본적으로 이미 개발이 완료된 패키지들의 recipe를 만들고, 이를 bitbake로 전체 이미지를 빌드하는 과정이다.
하지만 개발 진행 중인 소프트웨어 패키지를 yocto에 추가하고, 이를 계속 수정 개발을 할 때 어떤 방식으로 관리를 할지 고민을 하여야 한다. 여기에서는 이와 같이 개발 중인 패키지를 yocto 에 추가하여 빌드 하는 방법을 알아본다.
Yocto Project 개발하기(1) - Orange Pi 보드 빌드 Yocto Project 개발하기(2) - Custom Layer 만들기 Yocto Project 개발하기(3) - 개발 시 로컬 패키지 관리하기 Yocto Project 개발하기(4) - Yocto SDK 빌드 Yocto Project 개발하기(5) - Yocto eSDK 이용한 개발 모델 방법들예를 들어 u-boot 를 수정 하는 경우를 예로 들어 보자."><meta property="og:type" content="article"><meta property="og:url" content="https://blog.humminglab.io/posts/yocto-project-on-orange-pi-3/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-01-18T23:00:00+09:00"><meta property="article:modified_time" content="2022-01-18T23:00:00+09:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Yocto Project 개발하기(3) - 개발 시 로컬 패키지 관리하기"><meta name=twitter:description content="Yocto Project 개발 절차는 기본적으로 이미 개발이 완료된 패키지들의 recipe를 만들고, 이를 bitbake로 전체 이미지를 빌드하는 과정이다.
하지만 개발 진행 중인 소프트웨어 패키지를 yocto에 추가하고, 이를 계속 수정 개발을 할 때 어떤 방식으로 관리를 할지 고민을 하여야 한다. 여기에서는 이와 같이 개발 중인 패키지를 yocto 에 추가하여 빌드 하는 방법을 알아본다.
Yocto Project 개발하기(1) - Orange Pi 보드 빌드 Yocto Project 개발하기(2) - Custom Layer 만들기 Yocto Project 개발하기(3) - 개발 시 로컬 패키지 관리하기 Yocto Project 개발하기(4) - Yocto SDK 빌드 Yocto Project 개발하기(5) - Yocto eSDK 이용한 개발 모델 방법들예를 들어 u-boot 를 수정 하는 경우를 예로 들어 보자."><meta name=application-name content="All about IoT"><meta name=apple-mobile-web-app-title content="All about IoT"><meta name=theme-color content="#f8f8f8"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=canonical href=https://blog.humminglab.io/posts/yocto-project-on-orange-pi-3/><link rel=prev href=https://blog.humminglab.io/posts/yocto-project-on-orange-pi-2/><link rel=next href=https://blog.humminglab.io/posts/port-mirroring-network-switch-gs108ev3/><link rel=stylesheet href=/css/main.css><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/color.css><link rel=stylesheet href=/css/style.min.css><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=/lib/fontawesome-free/all.min.css><noscript><link rel=stylesheet href=/lib/fontawesome-free/all.min.css></noscript><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=/lib/animate/animate.min.css><noscript><link rel=stylesheet href=/lib/animate/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Yocto Project 개발하기(3) - 개발 시 로컬 패키지 관리하기","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/blog.humminglab.io\/posts\/yocto-project-on-orange-pi-3\/"},"genre":"posts","keywords":"Yocto, Linux, OrangePi","wordcount":571,"url":"https:\/\/blog.humminglab.io\/posts\/yocto-project-on-orange-pi-3\/","datePublished":"2022-01-18T23:00:00+09:00","dateModified":"2022-01-18T23:00:00+09:00","publisher":{"@type":"Organization","name":"HummingLab"},"authors":[{"@type":"Person","name":"YSLee"}],"description":""}</script><script src=//instant.page/5.2.0 defer type=module integrity=sha384-jnZyxPjiipYXnSU0ygqeac2q7CVYMbh84q0uHVRRxEtvFPiQYbXWUorga2aqZJ0z></script></head><body header-desktop header-mobile><script type=text/javascript>function setTheme(e){document.body.setAttribute("theme",e),document.documentElement.style.setProperty("color-scheme",e==="light"?"light":"dark"),window.theme=e,window.isDark=window.theme!=="light"}function saveTheme(e){window.localStorage&&localStorage.setItem("theme",e)}function getMeta(e){const t=document.getElementsByTagName("meta");for(let n=0;n<t.length;n++)if(t[n].getAttribute("name")===e)return t[n];return""}if(window.localStorage&&localStorage.getItem("theme")){let e=localStorage.getItem("theme");e==="light"||e==="dark"||e==="black"?setTheme(e):setTheme(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")}else""==="light"||""==="dark"||""==="black"?(setTheme(""),saveTheme("")):(saveTheme("auto"),setTheme(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"));let metaColors={light:"#f8f8f8",dark:"#252627",black:"#000000"};getMeta("theme-color").content=metaColors[document.body.getAttribute("theme")],window.switchThemeEventSet=new Set</script><div id=back-to-top></div><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="All about IoT">All about IoT</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/categories/>Categories </a><a class=menu-item href=https://www.humminglab.io/ rel="noopener noreferrer" target=_blank>HummingLab </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="All about IoT">All about IoT</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/posts/ title>Posts</a><a class=menu-item href=/tags/ title>Tags</a><a class=menu-item href=/categories/ title>Categories</a><a class=menu-item href=https://www.humminglab.io/ title rel="noopener noreferrer" target=_blank>HummingLab</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto><nav id=TableOfContents><ul><li><a href=#방법들>방법들</a></li><li><a href=#externalsrc>Externalsrc</a></li><li><a href=#사용-예>사용 예</a></li></ul></nav></div></div><script>document.getElementsByTagName("main")[0].setAttribute("autoTOC","true")</script><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Yocto Project 개발하기(3) - 개발 시 로컬 패키지 관리하기</h1><div class=post-meta><div class=post-meta-line><span class=post-author><span class=author><span class="author fas fa-user-circle fa-fw"></span><span class=screen-reader-text> </span><a href=https://blog.humminglab.io/authors/yslee>YSLee</a></span>
</span>&nbsp;<span class=post-category>included in </span>&nbsp;<span class=post-category>category <a href=/categories/development/><i class="far fa-folder fa-fw"></i>Development</a></span>&nbsp;<span class=post-category>and</span>&nbsp;<span class=post-series>series <a href=/series/yocto-project-%EA%B0%9C%EB%B0%9C%ED%95%98%EA%B8%B0/><i class="far fa-list-alt fa-fw"></i>Yocto Project 개발하기</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2022-01-18>2022-01-18</time>&nbsp;<i class="far fa-edit fa-fw"></i>&nbsp;<time datetime=2022-01-18>2022-01-18</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;571 words&nbsp;<i class="far fa-clock fa-fw"></i>&nbsp;3 minutes&nbsp;</div></div><div class="details series-nav open"><div class="details-summary series-title"><span>Series - Yocto Project 개발하기</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content series-content"><nav><ul><li><span class=active>Yocto Project 개발하기(3) - 개발 시 로컬 패키지 관리하기</span></li><li><a href=/posts/yocto-project-on-orange-pi-2/>Yocto Project 개발하기(2) - Custom Layer 만들기</a></li><li><a href=/posts/yocto-project-on-orange-pi-1/>Yocto Project 개발하기(1) - Orange Pi 보드 빌드</a></li></ul></nav></div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#방법들>방법들</a></li><li><a href=#externalsrc>Externalsrc</a></li><li><a href=#사용-예>사용 예</a></li></ul></nav></div></div><div class=content id=content><p>Yocto Project 개발 절차는 기본적으로 이미 개발이 완료된 패키지들의 recipe를 만들고, 이를 bitbake로 전체 이미지를 빌드하는 과정이다.</p><p>하지만 개발 진행 중인 소프트웨어 패키지를 yocto에 추가하고, 이를 계속 수정 개발을 할 때 어떤 방식으로 관리를 할지 고민을 하여야 한다.
여기에서는 이와 같이 개발 중인 패키지를 yocto 에 추가하여 빌드 하는 방법을 알아본다.</p><ul><li><a href=https://blog.humminglab.io/posts/yocto-project-on-orange-pi-1/ rel>Yocto Project 개발하기(1) - Orange Pi 보드 빌드</a></li><li><a href=https://blog.humminglab.io/posts/yocto-project-on-orange-pi-2/ rel>Yocto Project 개발하기(2) - Custom Layer 만들기</a></li><li><strong>Yocto Project 개발하기(3) - 개발 시 로컬 패키지 관리하기</strong></li><li>Yocto Project 개발하기(4) - Yocto SDK 빌드</li><li>Yocto Project 개발하기(5) - Yocto eSDK 이용한 개발 모델</li></ul><h2 id=방법들 class=headerLink><a href=#%eb%b0%a9%eb%b2%95%eb%93%a4 class=header-mark></a>방법들</h2><p>예를 들어 u-boot 를 수정 하는 경우를 예로 들어 보자.
수정되어 commit 된 경우라면 bb(append) recipe만 수정해서 재실행하면 되지만, commit 전에 yocto 에 추가하여 빌드하려면 다음과 같은 방법을 고려해 볼 수 있다.</p><ol><li>yocto build 디렉토리에 있는 소스를 수정하고 빌드하기</li><li>devshell task 를 실행하여 직접 수작업 빌드하기</li><li>externalsrc.bbclass 를 이용하여 poky 외부 소스를 참조하여 빌드하기</li></ol><p>첫번째 방법은 u-boot의 경우 소스코드는 <code>tmp/work/sc_gateway-poky-linux-gnueabi/u-boot/1_2021.07-r0/git</code> 에 다운로드 받아서 빌드된다. 이 디렉토리에 코드를 수정 후 아래 처럼 강제로 compile 부터 재실행하면 된다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ bitbake u-boot -c compile -f <span class=o>&amp;&amp;</span> bitbake u-boot
</span></span></code></pre></td></tr></table></div></div><p>이 방식의 단점은 실수로 clean, fetch, patch 등의 task를 수행하면 수정한 부분이 사라질 수 있다.</p><p>두번쨰 방식은 아래처럼 u-boot 빌드하는 shell 환경을 직접 실행하는 것이다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ bitbake u-boot -c devshell
</span></span></code></pre></td></tr></table></div></div><p>Shell 은 위 소스 디렉토리에서 실행되고, <code>export</code>로 보면 빌드에 필요한 환경 변수들이 모두 잡혀 있는 것을 확인할 수 있다. 이 shell에서 다음처럼 하면 bitbake로 compile 하는 것과 동일한 작업을 수행한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ ../temp/run.do_compile
</span></span></code></pre></td></tr></table></div></div><p>이 shell에서 다른 소스 코드를 빌드해 볼 수 있는데 번거롭다.</p><p>마지막 방법이 여기에서 설명할 방법으로 bitbake 빌드 과정과 동일하지만 소스 디렉토리, 빌드 디렉토리만 외부 폴더로 바꾸는 방법이다.</p><h2 id=externalsrc class=headerLink><a href=#externalsrc class=header-mark></a>Externalsrc</h2><p>관련 설명은 아래에서 찾을 수 있다.</p><ul><li><a href=https://docs.yoctoproject.org/dev-manual/common-tasks.html#building-software-from-an-external-source target=_blank rel="noopener noreferrer">3.10.6 Building Software from an External Source</a></li><li><a href="https://docs.yoctoproject.org/ref-manual/classes.html?highlight=externalsrc#externalsrc-bbclass" target=_blank rel="noopener noreferrer">5.31 externalsrc.bbclass</a></li><li><a href="https://docs.yoctoproject.org/ref-manual/variables.html?highlight=externalsrc#term-EXTERNALSRC" target=_blank rel="noopener noreferrer">EXTERNALSRC</a></li></ul><p>externalsrc.bbclass 의 기능을 이용하여 특정 recipe의 소스 디렉토리를 외부로 변경할 수 있다.</p><p>예를 들어 /home/yslee/u-boot 으로 clone 한 소스가 있고, 이를 bitbake 로 빌드를 하고 싶다면 local.conf 에 아래와 같이 추가하면 된다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>INHERIT += &#34;externalsrc&#34;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>EXTERNALSRC:pn-u-boot = &#34;/home/yslee/u-boot&#34;
</span></span><span class=line><span class=cl>EXTERNALSRC_BUILD:pn-u-boot = &#34;/home/yslee/u-boot&#34;
</span></span></code></pre></td></tr></table></div></div><ul><li>첫번째 줄은 externalsrc.bbclass를 추가하는 것이다. 이와 같은 conf 파일에는 <a href=https://docs.yoctoproject.org/bitbake/bitbake-user-manual/bitbake-user-manual-metadata.html#inherit-configuration-directive target=_blank rel="noopener noreferrer">INHERIT</a> 문법을 사용하고, .bb recipe 파일에는 <a href=https://docs.yoctoproject.org/bitbake/bitbake-user-manual/bitbake-user-manual-metadata.html#inherit-directive target=_blank rel="noopener noreferrer">inherit directive</a> 를 사용한다.</li><li><code>EXTERNALSRC:pn-</code>{PACKAGE_NAME} 로 패키지의 소스 디렉토리를 절대 경로로 기록한다. 이와 같이 하면 u-boot 는 빌드 시 recipe 에 정의된 소스 파일을 사용하지 않고, 이 디렉토리의 소스로 빌드를 수행한다.</li><li><code>EXTERNALSRC_BUILD:pn-</code>{PACKAGE_NAME} 로 패키지의 빌드 디렉토리를 절대 경로로 기록한다. 이 부분은 필요시에 추가하면 된다. 이를 추가하게 되면 compile 시 생성되는 파일도 해당 디렉토리에 생성된다. 실제 object 파일 등을 확인하려고 할때는 이와 같이 source 디렉토리에 생성되도록 하면 편리할 수도 있다.</li></ul><h2 id=사용-예 class=headerLink><a href=#%ec%82%ac%ec%9a%a9-%ec%98%88 class=header-mark></a>사용 예</h2><p>EXTERNALSRC 는 패키지 소스 수정이 필요한 경우 다음과 같은 절차로 진행한다.</p><ul><li>패키지의 소스를 외부 디렉토리로 다운로드 한다. 이와 같은 외부 빌드를 하는 경우 bitbake fetch, unpack, patch 과정 대신에 외부 소스를 참조하는 것이기 때문에, 만일 recipe에서 소스코드를 patch 한다면 이는 수작업으로 외부 소스에 반영하여야 한다.</li><li>local.conf 파일에 위와 같인 externalsrc를 추가하고, 외부 소스도 패키지 이름으로 EXTERNALSRC 으로 등록해 준다.</li><li><code>bitbake package_name</code> 와 같이 실행하면 해당 패키지가 컴파일 되고 다음 과정으로 진행한다.</li><li>코드 수정이 완료되면 git commit을 하고, 해당 tag를 recipe에 업데이트 한다.</li><li>최종적으로 local.conf의 EXTERNALSRC 부분을 삭제하고, 재빌드 해서 recipe에 정상적으로 반영되는지 확인한다.</li></ul><p>위와 같이 externalsrc 로 등록한 패키지의 경우 해당 compile task는 tained mode로 설정되어 <code>bitbake -f -c compile</code> 과 같이 force 옵션을 주지 않아도 매번 compile을 수행한다.</p><p>이와 같이 externalsrc 로 가장 자주 사용하는 부분은 kernel 수정 작업 시 이다. 커널의 경우 externalsrc로 설정하고 수정 후 빌드를 하면 의존성 있는 kernel module package 나 initramfs 와 같은 recipe도 재빌드 되어 수작업으로 패키징을 할 필요가 없다.</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2022-01-18</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/yocto/>Yocto</a>,&nbsp;<a href=/tags/linux/>Linux</a>,&nbsp;<a href=/tags/orangepi/>OrangePi</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/yocto-project-on-orange-pi-2/ class=prev rel=prev title="Yocto Project 개발하기(2) - Custom Layer 만들기"><i class="fas fa-angle-left fa-fw"></i>Yocto Project 개발하기(2) - Custom Layer 만들기</a>
<a href=/posts/port-mirroring-network-switch-gs108ev3/ class=next rel=next title="Port Mirroring 기능 지원 저렴한 스위치 - GS108Ev3">Port Mirroring 기능 지원 저렴한 스위치 - GS108Ev3<i class="fas fa-angle-right fa-fw"></i></a></div></div><div id=comments><div id=giscus></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://giscus.app/>giscus</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2023</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://www.humminglab.io target=_blank rel="noopener noreferrer">HummingLab</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div><div class=footer-line></div><div class=footer-line></div></div></footer></div><div id=fixed-buttons><a href=#back-to-top id=back-to-top-button class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw"></i></a></div><div class=assets><link rel=stylesheet href=/lib/katex/katex.min.css><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=/lib/katex/copy-tex.min.css><noscript><link rel=stylesheet href=/lib/katex/copy-tex.min.css></noscript><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:50},comment:{giscus:{darkTheme:"dark",dataCategory:"Announcements",dataCategoryId:"DIC_kwDOGdk00s4CAGXN",dataEmitMetadata:"0",dataInputPosition:"bottom",dataLang:"en",dataMapping:"pathname",dataReactionsEnabled:"1",dataRepo:"humminglab/blog.humminglab.io",dataRepoId:"R_kgDOGdk00g",dataStrict:"0",lightTheme:"light"}},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1}}</script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/katex/katex.min.js defer></script><script type=text/javascript src=/lib/katex/auto-render.min.js defer></script><script type=text/javascript src=/lib/katex/copy-tex.min.js defer></script><script type=text/javascript src=/lib/katex/mhchem.min.js defer></script><script type=text/javascript src=/js/katex.min.js defer></script><script type=text/javascript src=/js/theme.min.js defer></script><script type=text/javascript src=/js/giscus.min.js defer></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-83257319-3",{anonymize_ip:!0})</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=UA-83257319-3" async></script></div></body></html>